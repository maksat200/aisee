# AISee Backend

Бэкенд проект на Python с использованием uv для управления зависимостями.

## Предварительные требования

- Python >= 3.12
- uv - современный менеджер пакетов Python

### Установка uv

#### Windows:
```powershell
# PowerShell (с правами администратора)
powershell -ExecutionPolicy ByPass -c "irm https://astral.sh/uv/install.ps1 | iex"

# Или через pip
pip install uv
```

#### macOS/Linux:
```bash
# Через скрипт установки
curl -LsSf https://astral.sh/uv/install.sh | sh

# Или через Homebrew (macOS)
brew install uv
```

## Установка и настройка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/nik1t7n/aisee_backend.git
```

2. Перейдите в директорию проекта:
```bash
cd aisee_backend
```

3. Настройте переменные окружения:
   - Скопируйте файл `.env.example` в `.env`:
   ```bash
   cp .env.example .env
   ```
   - Отредактируйте файл `.env` и заполните следующие ключи:
   ```
   SECRET_KEY=ваш_секретный_ключ
   DATABASE_URL=sqlite+aiosqlite:///./aisee.db  # Уже заполнен
   ADMIN_CREATE_SECRET=секретный_ключ_для_создания_админа
   ```

4. Установите зависимости с помощью uv:
```bash
uv sync
```

5. Примените миграции базы данных:
```bash
uv run alembic upgrade head
```

## Запуск проекта

Для запуска проекта выполните:
```bash
uv run -m src.main
```

## Быстрый запуск

Для быстрого запуска проекта можно использовать скрипты из папки `scripts`:

### Windows:
```powershell
.\scripts\start.bat
```

### macOS/Linux:
```bash
./scripts/start.sh
```

Примечание: возможно, вам нужно будет дать права на выполнение скриптам:
```bash
chmod +x ./scripts/start.sh
```

## Структура проекта

Проект организован согласно лучшим практикам для FastAPI:

```
src/
  alembic/            # Миграции базы данных
    versions/         # Файлы версий миграций
    env.py            # Окружение Alembic
    README            # Документация Alembic
    script.py.mako    # Шаблон скриптов миграций
  api/                # Эндпоинты API
    auth.py           # Аутентификация и авторизация
    main.py           # Основные маршруты API
    user.py           # Управление пользователями
    video.py          # Работа с видео
  core/               # Ядро приложения
    config.py         # Конфигурация приложения
    db.py             # Настройки базы данных
  logic/              # Бизнес-логика
    customer_counter.py  # Подсчет клиентов
    people_counter.py    # Подсчет людей
  services/           # Сервисы приложения
    user.py           # Сервис пользователей
  auth.py             # Основной модуль аутентификации
  main.py             # Точка входа в приложение
  models.py           # Модели данных (ORM)
  schemas.py          # Схемы Pydantic
.env.example          # Пример переменных окружения
.gitignore            # Исключения Git
.python-version       # Версия Python
alembic.ini           # Конфигурация Alembic
db_test.py            # Тесты базы данных
pyproject.toml        # Настройки проекта
uv.lock               # Файл блокировки зависимостей uv
scripts/              # Скрипты для быстрого запуска
```

### Объяснение каждой папки:

- **alembic/** - Инструменты для миграции базы данных, позволяющие отслеживать изменения структуры БД.
- **api/** - Содержит все эндпоинты FastAPI, разделенные по функциональному назначению.
- **core/** - Ядро приложения, содержит базовые настройки, конфигурации и подключения.
- **logic/** - Бизнес-логика приложения, алгоритмы и обработка данных.
- **services/** - Слой сервисов между API и моделями, содержит бизнес-процессы.
- **auth.py** - Модуль аутентификации и авторизации.
- **main.py** - Входная точка приложения, инициализация FastAPI.
- **models.py** - ORM модели для работы с базой данных.
- **schemas.py** - Pydantic модели для валидации и сериализации данных.

Такая организация проекта обеспечивает четкое разделение ответственности, облегчает тестирование и поддержку кода.

## Лицензия

MIT